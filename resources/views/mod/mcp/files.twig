{% extends 'templates/mod/mcp/main.twig' %}

{% block title %}All Files{% endblock %}

{% block extrajs %}
	<script>
	function jq(myid) {
		return "#" + myid.replace(/(:|\.|\[|\]|,|=|\ |\-)/g, "\\$1");
	}

	$(function() {
		$('[id^=delete-file-]').click(function(event) {
			event.preventDefault();
			var filename = $(this).attr('id').replace('delete-file-', '');
			var element = this;
			$.get({
				url: '/delete/' + filename, // TODO: figure out how to get path for file.delete
				success: function() {
					$(element).parent().parent().remove();
				}
			});
			return false;
		});
	});
	</script>
{% endblock %}

{% block mcpcontent %}
	<div class="col-md-8">
		{% if files.count > 0 %}
			<table class="table table-striped table-bordered table-hover">
				<thead>
					<th>File</th>
					<th>Uploader</th>
					<th>Privacy</th>
					<th>Delete</th>
				</thead>
				{% for file in files %}
					<tr>
						<td>
							<a id="file-entry-{{ file.id ~ (file.filename is not empty ? '-' ~ file.filename : '') ~ (file.ext is not empty ? '.' ~ file.ext : '') }}" href="{{ path_for('file.view', {'filename': (file.id ~ (file.filename is not empty ? '-' ~ file.filename : '') ~ (file.ext is not empty ? '.' ~ file.ext : ''))}) }}">{{ file.id ~ (file.filename is not empty ? '-' ~ file.filename : '') ~ (file.ext is not empty ? '.' ~ file.ext : '') }}</a>
						</td>
						<td>
							<a href="{{ path_for('user.profile', {'id': file.user.id}) }}">{{ file.user.username }}</a>
						</td>
						<td>
							{{ file.privacy_state }}
						</td>
						<td>
							<a href="#" class="btn btn-danger" id="delete-file-{{ file.id ~ (file.filename is not empty ? '-' ~ file.filename : '') ~ (file.ext is not empty ? '.' ~ file.ext : '') }}">Delete</a>
						</td>
					</tr>
				{% endfor %}
			</table>
		{% else %}
			<b>There are no files to show. :(</b>
		{% endif %}
	</div>
	<div class="col-md-2">
		<h3>Privacy levels</h3>
		<p>
			0 - Public
		</p>
		<p>
			1 - Unlisted (not shown on profiles)
		</p>
		<p>
			2 - Private (requires login)
		</p>
	</div>
{% endblock %}
