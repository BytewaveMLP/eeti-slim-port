{% extends 'templates/mod/mcp/main.twig' %}

{% block title %}All Files{% endblock %}

{% block extrajs %}
	<script>
	function jq(myid) {
		return "#" + myid.replace(/(:|\.|\[|\]|,|=|\ |\-)/g, "\\$1");
	}

	$(function() {
		$('[id^=delete-file-]').click(function(event) {
			event.preventDefault();
			var filename = $(this).attr('id').replace('delete-file-', '');
			var element = this;
			$.get({
				url: {{ path_for('file.delete', {filename: ''}) }} + filename,
				success: function() {
					$(element).parent().parent().remove();
				}
			});
			return false;
		});
	});
	</script>
{% endblock %}

{% block mcpcontent %}
	<div class="col-md-8">
		{% if files.count > 0 %}
			<table class="table table-striped table-bordered table-hover">
				<thead>
					<th>File</th>
					<th>Uploader</th>
					<th>Privacy</th>
					<th>Delete</th>
				</thead>
				{% for file in files %}
					{% set filename = file.id ~ (file.filename is not empty ? '-' ~ file.filename : '') ~ (file.ext is not empty ? '.' ~ file.ext : '') %}
					<tr>
						<td>
							<a id="file-entry-{{ filename }}" href="{{ path_for('file.view', {'filename': filename}) }}">{{ filename }}</a>
						</td>
						<td>
							<a href="{{ path_for('user.profile', {'id': file.user.id}) }}">{{ file.user.username }}</a>
						</td>
						<td>
							{{ file.privacy_state }}
						</td>
						<td>
							<a href="#" class="btn btn-danger btn-xs" id="delete-file-{{ filename }}">Delete</a>
						</td>
					</tr>
				{% endfor %}
			</table>
		{% else %}
			<b>There are no files to show. :(</b>
		{% endif %}
	</div>
	<div class="col-md-2">
		<h3>Privacy levels</h3>
		<p>
			<b>0</b> - Public
		</p>
		<p>
			<b>1</b> - Unlisted (invisible on profiles to everyone but moderators)
		</p>
		<p>
			<b>2</b> - Private (like unlisted, but requires a user to be logged in to view)
		</p>
	</div>
{% endblock %}
